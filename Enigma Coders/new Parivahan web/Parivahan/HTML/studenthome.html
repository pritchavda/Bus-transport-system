<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parivahn History</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../css/index.css" rel="stylesheet" />
    <link rel="stylesheet" href="../css/history.css">
    <script src="https://js.api.here.com/v3/3.1/mapsjs-core.js"
    type="text/javascript" charset="utf-8"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-service.js"
    type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <div class="header">
        <h3 id="jdkfkl,djfskdsjf">Bus root</h3>
    </div>
    <div id="kid">

    </div>
    <div id="hihihi">
        
    </div>
</body>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.5/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.5/firebase-analytics.js";
    import { getDatabase, set, ref, update,get,child, onValue,push,remove } from "https://www.gstatic.com/firebasejs/9.6.5/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.5/firebase-auth.js";
    import { getStorage, ref as sRef , uploadBytesResumable, getDownloadURL} from "https://www.gstatic.com/firebasejs/9.6.5/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDzU2LsVytDkMXwCidTmO-E4-Xbg62Mdb0",
      authDomain: "parivahan-f7413.firebaseapp.com",
      databaseURL: "https://parivahan-f7413-default-rtdb.firebaseio.com",
      projectId: "parivahan-f7413",
      storageBucket: "parivahan-f7413.appspot.com",
      messagingSenderId: "127872997898",
      appId: "1:127872997898:web:1910d19b13d17210fb9df3",
      measurementId: "G-7VFN151RC8"
    };
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth();
    const database = getDatabase(app);
    const dbRef = ref(getDatabase());
    var driverId;
    var pickup;
    var dropup;
    var time;
    var date;
    var rating;
    var timeStamp;
    var pickuplat;
    var pickuplng;
    var droplat;
    var droplng;

  //  sos.addEventListener("click",(event)=>{
   //     alert("historyhhisto")
    //    get(child(dbRef, `admin/stopX`)).then((snapshot) => {
     //       if (snapshot.exists()) {
    //            console.log(snapshot.val());
    //            var arrr = Object.keys(snapshot.val());
    //
    
    //        } 
    //        else {
    //            document.getElementById('hihihi').innerHTML = 'bus is not available';
    //        }
     //       }).catch((error) => {
     //       console.error(error);
    //    });
    //});

    
    





     onAuthStateChanged(auth, (user) => {
        if (user) {
            get(child(dbRef, `admin/stopX`)).then((snapshot) => {
                    if (snapshot.exists()) {
                        console.log(snapshot.val());
                        stopss(snapshot.val());
                        localStorage.setItem('allname',snapshot.val());

                    } 
                    else {
                        document.getElementById('hihihi').innerHTML = 'bus is not available';
                    }
                    }).catch((error) => {
                    console.error(error);
                });
        }
        else{
            console.log('user is not avelable');
        }
    });

    function myFunction(){
        alert("dfsdsjf")
    }
    
    function stopss(stops) {
        var arrr = Object.keys(stops);
        console.log(Object.entries(stops));
        localStorage.setItem('historyarray',arrr);
        for (let index = 0; index < arrr.length; index++) {
            console.log( 'lenth'+arrr[index])

           // setdata(arrr[index]);
          fun(arrr[index],index);
        }
    }
    
  
    
        function setdata(data)
        {
            get(child(dbRef, `admin/stops/${data}`)).then((snapshot) => {
                if (snapshot.exists()) {
                    console.log(snapshot.val());
                    get(child(dbRef, `admin/stops/${data}/no`)).then((snapshot) => {
                        console.log(snapshot.val().no);
                        
                        for (let index = 1; index < snapshot.val().no; index++) {

                            console.log("ss is"+ data);
                              var str =   '<div  class="historyitem">';
                               str +=   '<div class="historyitemleft">';
                                str +=   '<p id='+ data+'>'+data+'</p>';
                                 str +=   '</div>';
                               str +=   '</div>';
                               document.getElementById('hihihi').innerHTML+= str;
                            // document.getElementById('demo').innerHTML+= '<p>'+arrr[index]+'</p>';    
                            data.addEventListener("click", data);
                            data.onclick = function() { alert("0000000000000000000") };    
                        }
                    })

                } 
                else {
                  
                }
                }).catch((error) => {
                console.error(error);
            });
        }


  

    

</script>


<script>


    document.getElementById('jdkfkl,djfskdsjf').addEventListener("click",(event)=>{
                alert("jfdskfjsl");
    })
    
    function fun(id ,idnum){
        alert(id);

        var str =   '<div  class="historyitem" onclick = "funn('+idnum+')">';
            str +=   '<p id = '+id+ '>'+id+'</p>';
           str +=   '</div>';
        document.getElementById('hihihi').innerHTML+= str; 
    }
    function funn(dno){
        localStorage.setItem('dno',dno);
        localStorage.setItem('dno',dno);
        location.replace("studenthome.html");
    }

    
</script>

</html>